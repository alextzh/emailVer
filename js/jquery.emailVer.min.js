(function(a){a.fn.emailVer=function(d){var e={list:["qq.com","gmail.com","126.com","163.com","hotmail.com","yahoo.com","yahoo.com.cn","live.com","sohu.com","sina.com"],reg:/^([a-zA-Z0-9._-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,6}){1,2})$/,errorTextGoal:a('span[data-tips="inp_email"]'),errorText:["你输入的邮箱地址有误，请修改","&radic;"],callback:null},d=a.extend(e,d),f={bar:a("<div>").addClass("m_emailVer"),list:a("<div>").addClass("m_emailVer_list")},c=this,b={V:function(){f.bar.append(f.list);c.parent().append(f.bar);c.addClass("m_emailVer_value");f.bar.append(c);f.list.css({top:f.bar.css("height")})},C:{init:function(){var g=this;b.V();document.onkeydown=g.isKey;c.keyup(function(h){var i=a(this).val();if(i.indexOf("@")>-1){g.showList(h,i);return false}f.list.hide()}).blur(function(){var h=a(this).val();if(f.list.is(":visible")){return false}if(!d.reg.test(h)&&d.errorTextGoal){d.errorTextGoal.html(d.errorText[0]);c.addClass("bc_red");return false}if(d.reg.test(h)&&d.errorTextGoal){d.errorTextGoal.html(d.errorText[1]);c.removeClass("bc_red");return false}}).focus(function(h){if(d.errorTextGoal){c.removeClass("bc_red");d.errorTextGoal.html("")}var i=a(this).val();g.showList(h,i)}).click(function(){return false});f.list.delegate("li","click",function(){c.val(a(this).attr("data-val"));f.list.hide()});a("body").click(function(){f.list.hide()});if(d.callback){d.callback()}},isKey:function(l){var h=f.list.find("li").length,n=f.list.find("li:eq(0)"),m=f.list.find("li:eq("+(h-1)+")"),j=f.list.find(".fn_emailActive");if(h>0){if(l.keyCode==38){g()}if(l.keyCode==40){i()}if(l.keyCode==13){k()}}function g(){if(j.html().indexOf(n.html())>-1){j=m}else{j=j.prev()}j.addClass("fn_emailActive").siblings().removeClass("fn_emailActive");return false}function i(){if(j.html().indexOf(m.html())>-1){j=n}else{j=j.next()}j.addClass("fn_emailActive").siblings().removeClass("fn_emailActive");return false}function k(o){if(h>0){c.val(j.html());f.list.hide();return false}}},listDOM:function(m){var j=0,g=d.list.length,h="",k="";var l=m.split("@");for(;j<g;j++){if(d.list[j].indexOf(l[1])>-1){h=l[0]+"@"+d.list[j];k+='<li data-val="'+h+'">'+h+"</li>"}}return k},showList:function(h,j){var i=this;if(j.length>0&&j.indexOf("@")>-1){if(h.keyCode==38||h.keyCode==40||h.keyCode==13){return false}var g=i.listDOM(j);if(g.length>0){f.list.html("<ul>"+g+"</ul>").slideDown("fast");f.list.find("li:eq(0)").addClass("fn_emailActive").siblings().removeClass("fn_emailActive");return false}}f.list.html("<ul></ul>");f.list.hide()}}};b.C.init()}})(jQuery);
